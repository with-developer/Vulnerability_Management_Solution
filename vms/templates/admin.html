{% extends 'layout.html' %}

{% block content %}


<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
      <h1 class="h2">Connecting Agents</h1>
      <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
          <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#exampleModal">Connect Agent</button>
          <!-- Button trigger modal -->
  
          <!-- Modal Page Start-->
          <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Connect Agent</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <form >
                    <div class="mb-3">
                      <label for="recipient-name" class="col-form-label">Server Name(description)</label>
                      <input type="text" class="form-control" id="server_name">
                    </div>
                    <div class="mb-3">
                      <label for="message-text" class="col-form-label">Server IP</label>
                      <input type="text" class="form-control" id="server_ip">
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button type="submit" id="connectButton" class="btn btn-primary">Connect</button>
                </div>
              </div>
            </div>
          </div>
          <!-- Modal Page END -->  

          <!-- Modal Data Post Start -->
          <script>
            $(document).ready(function() {
                document.getElementById("connectButton").addEventListener("click", function(e) { // 'e'를 매개변수로 추가
                    e.preventDefault(); // Prevent the default form submit action
                    
                    var serverName = $('#server_name').val();
                    var serverIp = $('#server_ip').val();
        
                    $.ajax({
                        type: "POST",
                        url: "/admin/api/agent_connect",
                        data: {
                            server_name: serverName,
                            server_ip: serverIp
                        },
                        success: function (response) {
                            console.log(response)
                            if (response['result'] == 'success') {
                                alert(response['message'])
                                window.location.href = '/admin'
                            } else {
                                alert(response['message'])
                            }
                        },
                        error: function(error) {
                            // Handle error
                            alert("Error sending data.");
                        }
                    });
                });
            });
        </script>
        <!-- Modal Data Post End -->

        </div>
      </div>
    </div>
    <div>
        <form class="row g-3">
            <div class="col-auto" style="width:45%">
              <input class="form-control" type="text" placeholder="Default input" aria-label="default input example">
            </div>
            <div class="col-auto">
              <button type="submit" class="btn btn-primary mb-3">Search</button>
            </div>
          </form>
    </div>
    <div>
        <table class="table table-hover">
            <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Server Name</th>
                  <th scope="col">IP</th>
                  <th scope="col">Last Scan</th>
                  <th scope="col">Config</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th scope="row">1</th>
                  <td>nginx</td>
                  <td>192.168.0.5</td>
                  <td>23.08.09</td>
                  <td><button type="button" class="btn btn-success btn-sm">Config</button></td>
                </tr>
                <tr>
                  <th scope="row">2</th>
                  <td>apache2</td>
                  <td>192.168.0.72</td>
                  <td>23.08.07</td>
                  <td><button type="button" class="btn btn-success btn-sm">Config</button></td>
                </tr>
                <tr>
                  <th scope="row">3</th>
                  <td>DB</td>
                  <td>192.168.0.7</td>
                  <td>23.08.02</td>
                  <td><button type="button" class="btn btn-success btn-sm">Config</button></td>
                </tr>
              </tbody>
        </table>
    </div>

    <h2>Section title</h2>
    <div class="table-responsive small">
      
    </div>
  </main>



{% endblock %}