<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h3 class="h3">Script Manager</h3>
</div>

<div>
    <table class="table table-hover table-sm">
        <thead>
            <tr>
                <th scope="col">OS</th>
                <th scope="col">Script Name</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for os_type, script_files in scripts.items() %}
                {% for script_file in script_files %}
                    <tr>
                        {% if loop.first %}
                            <th scope="row" rowspan="{{ script_files|length }}">{{ os_type }}</th>
                        {% endif %}
                        <td>{{ script_file }}</td>
                        <td>
                            <div class="btn-group">
                                <button type="button" style="font-size: 0.5rem" class="btn btn-info btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                    Actions
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <!-- `data-*` attributes to hold the file's path information -->
                                    <li><a class="dropdown-item view-script" href="#" data-os-type="{{ os_type }}" data-script-name="{{ script_file }}">View Script</a></li>
                                    <li><a class="dropdown-item" href="#">Edit Script</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal -->
<div class="modal fade" id="scriptModal" tabindex="-1" aria-labelledby="scriptModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" style="max-width: 65%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="scriptModalLabel">View Script</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <pre style="max-height:400px; overflow-y:auto;"><code id="scriptContent" class="bash"></code></pre>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $(".view-script").click(function(e) {
            e.preventDefault();
            
            // Get file path from the `data-*` attributes
            var osType = $(this).data("os-type");
            var scriptName = $(this).data("script-name");

            // AJAX call to get script content
            $.ajax({
                type: "GET",
                url: "/admin/api/get_script",
                data: {
                    os_type: osType,
                    script_name: scriptName
                },
                success: function(response) {
                    // Insert script content into the modal and show it
                    $("#scriptContent").text(response);
                    hljs.highlightBlock(document.getElementById("scriptContent"));
                    $("#scriptModal").modal("show");
                    
                },
                error: function(error) {
                    alert("Error fetching script.");
                }
            });
        });
    });
</script>
