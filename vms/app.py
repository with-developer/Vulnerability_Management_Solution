from flask import Flask, render_template, jsonify, request, session, redirect, url_for, current_app
from pymongo import MongoClient
from views.user import bp as user
# from views.admin import bp as admin
from views.dashboard import bp as dashboard
from views.remote_manager import bp as remote_manager
from views.script_manager import bp as script_manager
from views.api.script_manager import bp as api_script_manager
from views.api.agent_manager import bp as api_agent_manager


app = Flask(__name__)
app.register_blueprint(user)
# app.register_blueprint(admin)
app.register_blueprint(dashboard)
app.register_blueprint(remote_manager)
app.register_blueprint(script_manager)


app.register_blueprint(api_script_manager)
app.register_blueprint(api_agent_manager)


@app.before_first_request
def init_app():
    client = MongoClient('mongodb://root:test@mongodb:27017/?authMechanism=DEFAULT')
    current_app.db = client.VMS
    socket_port = 13469

if __name__ == '__main__':
    app.run(host='0.0.0.0',port=80, debug=True)
    