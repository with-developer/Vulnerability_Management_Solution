import jwt
from functools import wraps
from flask import request, jsonify, abort

SECRET_KEY = 'test_key'

def token_required(f):
    @wraps(f)
    def decorated(*args, **kwargs):
        # Get token from 'sessionid' cookie
        token = request.cookies.get('sessionid')

        if not token:
            abort(401)

        try:
            # Decode the token and check its validity
            data = jwt.decode(token, SECRET_KEY, algorithms=["HS256"])
            current_user = data['id']
        except jwt.ExpiredSignatureError:
            abort(401)
        except:
            abort(401)

        return f(current_user, *args, **kwargs)
    return decorated
