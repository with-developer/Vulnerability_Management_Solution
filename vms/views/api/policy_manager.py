from flask import Blueprint, request, jsonify, current_app
import os
import re
from datetime import datetime

bp = Blueprint('policy_manager_api', __name__, url_prefix='/api')


@bp.route('/change_risk', methods=['POST'])
def change_risk():
    risk = request.form.get('risk')
    policy_id = request.form.get('policy_id')
    current_app.logger.debug("risk: %s",risk)
    current_app.logger.debug("policy id: %s",policy_id)

    # 데이터베이스를 업데이트하는 로직
    result = current_app.db.policy.update_one(
        {'policy_num': policy_id}, 
        {'$set': {'risk': risk}}
    )
    current_app.logger.debug("result: %s",result)

    # 만약 업데이트가 성공적으로 이루어지지 않았다면 실패 메시지 반환
    if result.matched_count == 0:
        return jsonify(status="fail")
    
    # 모든 것이 정상적으로 처리되면 "success"를 반환합니다.
    return jsonify(status="success")