from flask import Blueprint, render_template, request, jsonify, current_app
from .api.check_auth import token_required


bp = Blueprint('remote_manager', __name__, url_prefix='/remote_manager')

@bp.route('/')
@token_required
def dashboard(current_user):
    page = request.args.get('page', 1, type=int)
    per_page = 10  # 한 페이지에 표시될 데이터의 개수
    total_agents = current_app.db.agents.count_documents({})
    total_pages = (total_agents // per_page) + (1 if total_agents % per_page != 0 else 0)

    agents_info = current_app.db.agents.find().skip((page-1)*per_page).limit(per_page)
    return render_template('remote_manager.html', agents=agents_info, total_pages=total_pages, current_page=page)