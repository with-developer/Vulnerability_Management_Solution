from flask import Blueprint, render_template, request, jsonify, current_app
from .api.check_auth import token_required

bp = Blueprint('policy_manager', __name__, url_prefix='/policy_manager')

@bp.route('/')
@token_required
def dashboard(current_user):
    page = request.args.get('page', 1, type=int)
    per_page = 7  # 한 페이지에 표시될 데이터의 개수
    total_policies = current_app.db.policy.count_documents({})  # Confirm if the collection name is 'policy'
    current_app.logger.debug("total policy: %s",total_policies)
    total_pages = (total_policies // per_page) + (1 if total_policies % per_page != 0 else 0)

    start_entry = (page-1) * 7 + 1
    end_entry = min(page * 7, total_policies)

    policies_info = current_app.db.policy.find().skip((page-1)*per_page).limit(per_page)
    return render_template('policy_manager.html', policies=policies_info, total_pages=total_pages, current_page=page, total_policies=total_policies, start_entry=start_entry, end_entry=end_entry)
